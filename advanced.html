<html>
	<head>
		<meta charset="utf-8">
		<title>GITTA Map Projections</title>
        <link rel='stylesheet' href='app.css' type='text/css'/>
        <link rel='stylesheet' href='stretch_widget.css' type='text/css'/>
	</head>
	<body>
		<div id ="controls">
          <form style="font-weight: normal" id="surface_geometry">
            <fieldset id="geometry-fieldset" class="centered">
            <b>geometry</b>
            <br>
            <table>
             <tr>
              <td class="controls-label">axis length</td>
              <td><input id="axis_slider" class="slider" type="range"  min="0" max="8" step="0.01" value="1"/></td>
              <td><input id="axis_box"    class="box"    type="number" min="0" max="8" step="0.01" value="1"/><br></td>
             </tr>
             <tr>
              <td class="controls-label">upper radius</td>
              <td><input id="upper_radius_slider" class="slider" type="range"  min="0.01" max="4" step="0.01" value="1"/></td>
              <td><input id="upper_radius_box"    class="box"    type="number" min="0.01" max="4" step="0.01" value="1"/></td>
             </tr>
             <tr>
              <td class="controls-label">lower radius</td>
              <td><input id="lower_radius_slider" class="slider" type="range"  min="0.01" max="4" step="0.01" value="1"/></td>
              <td><input id="lower_radius_box"    class="box"    type="number" min="0.01" max="4" step="0.01" value="1"/></td>
             </tr>
             <tr>
              <td class="controls-label">offset</td>
              <td><input id="geometry_offset_slider" class="slider" type="range"  min="-2" max="2" step="0.01" value="0"/></td>
              <td><input id="geometry_offset_box"    class="box"    type="number" min="-2" max="2" step="0.01" value="0"/></td>
             </tr>
            </table>
             </fieldset>
          </form>
          
          <form style="font-weight: normal" id="surface_orientation">
            <fieldset id="orientation-fieldset" class="centered">
              <b>orientation</b>
              <br>
              <table>
              <tr>
                <td class="controls-label">latitude [°]</td>
                <td><input id="lat_slider" class="slider" type="range" min="-90" max="90" step="1" value="90"/></td>
                <td><input id="lat_box"    class="box" type="number" min="-90" max="90" step="1" value="90"/><br></td>
              </tr>
              <tr>
                <td class="controls-label">longitude [°]</td>
                <td><input id="lon_slider" class="slider" type="range" min="-180" max="180" step="1" value="0"/></td>
                <td><input id="lon_box"    class="box" type="number" min="-180" max="180" step="1" value="0"/></td>
              </tr>
              <tr>
                <td class="controls-label">rotation [°]</td>
                <td><input id="rot_slider" class="slider" type="range" min="-180" max="180" step="1" value="0"/></td>
                <td><input id="rot_box"    class="box" type="number" min="-180" max="180" step="1" value="0"/></td>
              </tr>
              </table>
            </fieldset>  
          </form>
          
          <form style="font-weight: normal" id="lightsource">
            <fieldset class="centered">
              <b>light source</b>
              <br>
              <table>
             <tr>
              <td class="controls-label">relative latitude</td>
              <td><input id="lightsource_latitude_slider" class="slider" type="range"  min="-180" max="180"  step="1" value="0"/></td>
              <td><input id="lightsource_latitude_box"    class="box"    type="number"  min="-180" max="180" step="1" value="0"/></td>
             </tr>
             <tr>
              <td class="controls-label">relative longitude</td>
              <td><input id="lightsource_longitude_slider" class="slider" type="range"  min="-180" max="180"  step="1" value="0"/></td>
              <td><input id="lightsource_longitude_box"    class="box"    type="number"  min="-180" max="180" step="1" value="0"/></td>
             </tr>
             <tr>
              <td class="controls-label">offset</td>
              <td><input id="lightsource_offset_slider" class="slider" type="range"  min="-2"   max="2"   step="0.01" value="0"/></td>
              <td><input id="lightsource_offset_box"    class="box"    type="number" min="-100" max="100" step="0.01" value="0"/></td>
             </tr>
             <tr>
              <td class="controls-label">scale</td>
              <td><input id="lightsource_scale_slider" class="slider" type="range"  min="0.01"   max="2"   step="0.01" value="0"/></td>
              <td><input id="lightsource_scale_box"    class="box"    type="number" min="0.01"   max="100" step="0.01" value="0"/></td>
             </tr>
              </table>
            </fieldset>
          </form>
          
          <form style="font-weight: normal" id="textures">
            <fieldset class="centered">
              <b>layers</b>
              <br>
              <table class="center-table">
                 <tr>
                  <td>borders</td>
                  <td><input type="checkbox" id="borders-checkbox" checked=""><br></td>
                 </tr>
                 <tr>
                  <td>graticule</td>
                  <td><input type="checkbox" id="graticule-checkbox" checked=""><br></td>
                 </tr>
                 <tr>
                  <td>Tissots indicatrices</td>
                  <td><input type="checkbox" id="tissot-checkbox" checked=""><br></td>
                 </tr>
              </table>
            </fieldset>
          </form>
             <div class="centered">
              <button type="button" id="reset-button" onclick="tutorialControls.resetControls()">reset</button>
              <button type="button" id="remove-line-button" onclick="lineProjector.disableLines()">remove line</button>
              <button type="button" id="roll-button" onclick="rollPressed()">flatten</button>
            </div>
            <div id="sw-container">
                <!--<div class="centered"><b>scaling function</b></div>-->
                <div id="sw-graph"></div>
                <div id="sw-controls"></div>
            </div>
		</div>
		<div id="webgl_canvas"></div>
		<div id="explanation">
			 <!-- Tab links -->
			<div class="tab">
			  <button id="tut1-button" class="tablinks" onclick="openTab('tut1-button', 'tut1')">Map Distortion Basics</button>
			  <button id="tut2-button" class="tablinks" onclick="openTab('tut2-button', 'tut2')">Distortion Properties</button>
			  <button id="tut3-button" class="tablinks" onclick="openTab('tut3-button', 'tut3')">The Mercator Projection</button>
			</div>

			<!-- Tab content -->
			<div id="tut1" class="tabcontent">
				Each map projection distorts the surface of the earth.
                Although these distortions can be precisly mathematically quantified, a more intuitive approach to these distortions can be followed using Tissot's indicatrix.
                Tissot's indicatrix is a graphical means to analyze such distortions and can be enabled by ticking the box labeled "Tissots indicatrices" in the "layers" section of the controls panel.
				
				<br>
				
				Tissot's indicatrices can be interpreted as perfect circles covering the earth's surface.
                On the earth, each circle covers the same extent and has the very same diameter in all directions.
                However, investigating the shape of the indicatrices on a projection surface, allows one to understand how the features on the earth's surface are distorted.
                Specifically, one may want to investigate the following properties of Tissots indicatrix:
				<br>
				Tissots indicatrix forms a perfect circle: In such a case, the map projection preserves the angles encountered on the earth's surface.
                This means that an angle measured on the map is identical to the angle measured on the respective location on the earth's surface.
                This property is particular of interest for navigation purposes. A map with this property is also called "conformal".
                Use the following button to construct the conformal "sterographic azimuthal" projection:
				
					<br><button onclick="tutorialControls.setProjection('stereographic azimuthal')">Stereographic Azimuthal Projection</button><br>		
				
				<br>
				
			</div>
            
			<div id="tut2" class="tabcontent">
                So far we discussed map projections that are constructed by using a single projection center.
                With the exception of the Stereographic Azimuthal Projection, these rarely have interesting properties.
                
                <br><button onclick="tutorialControls.setProjection('lamberts equal area cylindrical')">Lambert's Equal Area Projection</button><br>		
                <br><button onclick="tutorialControls.setProjection('brauns stereographic cylindrical')">Braun's Stereographic Cylindrical Projection</button><br>		
                <br><button onclick="tutorialControls.setProjection('brauns pseudomercator')">Braun's Pseudomercator</button><br>		
                
			</div>
            
			<div id="tut3" class="tabcontent">
                Some projections
				You now learned the general concepts behind the construction of map projections as exemplified with the true perspective projections.
                
                The elongation along one axis of Tissots indicatrix is constant along specific lines (e.g., meridians or standard parallels): In this case, the map projection preserves distances along such lines. This means that measuring distances along one of these lines is directly proportional to the distance of the earth's surface along this line given a specific scale. A map with this property is also called "equidistant". Use the following button to construct the equidistant central cylindrical projection:
				
					<br><button onclick="tutorialControls.setProjection('central cylindrical')">Central Cylindrical Projection</button><br>		
				
				<br>
				Tissots indicatrices are shaped differently but show the same size: In such a case, the map projection preserves the areas of features of the earth's surface. Although the shape of countries, for example, are highly distorted, they cover the same area as in the real world (given a certain scaling factor). A map with such a property is also called "equal-area". Sadly, the tool currently does not support the construction of an equal-area map projection.
				<br>
				
				 Apart from these main properties of map projections, specifically the term "compromising" can be found in the literature, denoting map projections which reduce the distortions mentioned above while not entirely eliminating any of them.
				  
                
                
                <button onclick="tutorialControls.setScale('central cylindrical to mercator')">scale to Mercator</button><br></div>
			</div>
		</div>
		<script src="libs/three.js"></script>
		<script src="libs/OrbitControls.js"></script>
		<script src="libs/d3.v4.min.js"></script>
		
		<script src="glcanvas.js"></script>
		<script src="earth.js"></script>
		<script src="surface.js"></script>
		<script src="projectionCenter.js"></script>
		<script src="lineProjector.js"></script>
		<script src="cutIndicator.js"></script>
		
		<script src="sliderAnimator.js"></script>
		<script src="tutorialControls.js"></script>
		<script src="controls.js"></script>
        
        <script src="stretchWidget.js"></script>
        <script src="stretchEditControls.js"></script>

		<script>

		var glcanvas = new GLCanvas("webgl_canvas");
        
        var earth = new Earth(glcanvas.scene, glcanvas.renderer);
		var stretchWidget = new StretchWidget("sw-graph", "sw-controls");
        stretchWidget.disable();
		var surface = new Surface(glcanvas.scene, glcanvas.renderer, earth, stretchWidget);
		var projectionCenter = new ProjectionCenter(glcanvas.scene);
		var cutIndicator = new CutIndicator(surface, glcanvas.scene);
		var lineProjector = new LineProjector(glcanvas, surface, earth, projectionCenter);
		
		var controls = new Controls(glcanvas, earth, surface, stretchWidget, projectionCenter, cutIndicator, lineProjector);
        var sliderAnimator = new SliderAnimator(controls, surface);
        
		var tutorialControls = new TutorialControls(controls, sliderAnimator, stretchWidget, projectionCenter, glcanvas);
		controls.reset();
        tutorialControls.resetControls(0.01);
		
		var clock  = new THREE.Clock();
		
		var animate = function () {
			var delta = clock.getDelta();
			requestAnimationFrame(animate);

			glcanvas.update(delta);
			surface.update(delta);
			sliderAnimator.update(delta);
            stretchWidget.update(delta);
			cutIndicator.updateGeometry();
		};

		animate();
		


		// tabs
		function openTab(buttonName, tabName) {
			// Declare all variables
			var i, tabcontent, tablinks;

			// Get all elements with class="tabcontent" and hide them
			tabcontent = document.getElementsByClassName("tabcontent");
			for (i = 0; i < tabcontent.length; i++) {
				tabcontent[i].style.display = "none";
			}

			// Get all elements with class="tablinks" and remove the class "active"
			tablinks = document.getElementsByClassName("tablinks");
			for (i = 0; i < tablinks.length; i++) {
				tablinks[i].className = tablinks[i].className.replace(" active", "");
			}

			// Show the current tab, and add an "active" class to the button that opened the tab
			document.getElementById(tabName).style.display = "block";
			document.getElementById(buttonName).className += " active";
		}

		document.getElementById("tut1-button").click();
		

		</script>
	</body>
</html>